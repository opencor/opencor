name: cd

on:
  pull_request:
    branches: [ master ]
  workflow_dispatch:

jobs:
  cd:
    name: Generate and deploy OpenCOR's user documentation
    if: ${{ github.head_ref == 'new-snapshot' }}
    runs-on: ubuntu-latest
    steps:
      - name: Install CMake and Ninja
        uses: lukka/get-cmake@latest
      - name: Install packages
        run: sudo apt install python3-sphinx
      - name: Retrieve OpenCOR's user documentation
        run: git clone https://github.com/opencor/user-documentation
      - name: Build OpenCOR's user documentation
        run: |
          cd user-documentation
          ./opencor
      - name: Retrieve OpenCOR's GitHub Pages
        run: git clone https://github.com/opencor/opencor.github.io.git
      - name: Update OpenCOR's GitHub Pages
        run: |
          cd opencor.github.io
          git rm -fr *
          touch .nojekyll
          cp -fr ../user-documentation/build/html/* .
          git add -A
          git commit -m "OpenCOR's user documentation"
          git push -f
