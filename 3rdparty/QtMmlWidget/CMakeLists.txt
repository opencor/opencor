PROJECT(QtMmlWidget)

# Files that make up QtMmlWidget

SET(SOURCES
    src/qtmmlwidget.cpp
)

SET(HEADERS
    src/qtmmlwidget.h
)

# Various include directories

SET(LOCAL_3RDPARTYLIB_SUBDIRS include src)
SET(3RDPARTYLIB_SUBDIRS ${LOCAL_3RDPARTYLIB_SUBDIRS} PARENT_SCOPE)

INCLUDE_DIRECTORIES(${LOCAL_3RDPARTYLIB_SUBDIRS})

# Qt specific

FIND_PACKAGE(Qt4 4.6.0 REQUIRED)

INCLUDE(${QT_USE_FILE})

# Rules to build QtMmlWidget

IF(APPLE)
    SET(LIBRARY_OUTPUT_PATH ${CMAKE_BINARY_DIR}/lib)
ELSE()
    SET(LIBRARY_OUTPUT_PATH ${CMAKE_BINARY_DIR})
ENDIF()
# Note: the above is only required so that we can quickly test OpenCOR without
#       first having to package everything

ADD_LIBRARY(${PROJECT_NAME} SHARED
    ${SOURCES}
)

TARGET_LINK_LIBRARIES(${PROJECT_NAME}
    ${QT_QTCORE_LIBRARY}
    ${QT_QTGUI_LIBRARY}
    ${QT_QTXML_LIBRARY}
)

# Compiler and linker options

IF(NOT "$ENV{DEBUG_MODE}" STREQUAL "ON")
    SET(CMAKE_CXX_FLAGS "-O2 -ffast-math")
ENDIF()

IF(NOT APPLE)
    SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES LINK_FLAGS "-Wl,-s")
ENDIF()

# Rules to package QtMmlWidget

IF(WIN32)
    INSTALL(TARGETS ${PROJECT_NAME} RUNTIME DESTINATION bin)
ELSEIF(NOT APPLE)
    INSTALL(TARGETS ${PROJECT_NAME} LIBRARY DESTINATION lib)
ENDIF()
